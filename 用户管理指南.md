# 用户管理指南

## 📚 概述

本系统支持多租户管理，每个管理员只能看到和管理自己创建的抽奖活动。

---

## 🔧 管理工具

### 1. 创建新用户 ⭐ 常用

```bash
cd backend

# 方式一：交互式创建（推荐新手）
python create_user.py

# 方式二：命令行创建（快速）
python create_user.py boss1 password123 老板1 boss1@example.com
```

**参数说明：**
- 第1个参数：用户名（必填）
- 第2个参数：密码（必填）
- 第3个参数：姓名（可选，默认为用户名）
- 第4个参数：邮箱（可选，默认为 用户名@example.com）

**示例：**

```bash
# 创建老板2的账号
python create_user.py boss2 mypassword 张老板 zhang@company.com

# 创建老板3的账号（简化版）
python create_user.py boss3 password3
```

---

### 2. 查看所有用户

```bash
python list_users.py
```

**显示内容：**
- 用户名
- 姓名
- 邮箱
- 拥有的抽奖数量
- 创建时间
- 最后登录时间

---

### 3. 修改密码

```bash
# 方式一：交互式修改
python change_password.py

# 方式二：命令行修改
python change_password.py boss1 newpassword123
```

---

## 📋 典型场景

### 场景1：为新老板开通账号

```bash
# 1. 创建账号
python create_user.py boss2 secure123 李老板 li@example.com

# 2. 将登录信息发送给老板
用户名: boss2
密码: secure123
登录地址: http://localhost:8080/login

# 3. 验证创建成功
python list_users.py
```

### 场景2：老板忘记密码

```bash
# 1. 重置密码
python change_password.py boss2 newpassword456

# 2. 将新密码告知老板
```

### 场景3：查看系统使用情况

```bash
# 查看所有用户及其抽奖数量
python list_users.py
```

---

## 🔒 数据隔离说明

### 自动隔离机制

每个管理员登录后：
- ✅ **只能看到**自己创建的抽奖
- ✅ **只能编辑**自己的抽奖
- ✅ **只能删除**自己的抽奖
- ✅ **创建的新抽奖**会自动归属于自己

### 示例

```
admin 用户登录
  → 看到 25 个抽奖（之前迁移的数据）

boss2 用户登录
  → 看到 0 个抽奖（刚创建账号）
  → 创建抽奖A
  → 现在看到 1 个抽奖

boss3 用户登录
  → 看不到 admin 和 boss2 的抽奖 ✅
  → 只能看到自己创建的抽奖
```

---

## 💡 最佳实践

### 1. 用户命名规范

建议使用有意义的用户名：
- ✅ `shop_beijing`（北京店）
- ✅ `manager_zhang`（张经理）
- ✅ `boss1`, `boss2`（老板1、老板2）
- ❌ `user123`（不推荐，难以识别）

### 2. 密码安全

- 初始密码不要太简单
- 建议至少 8 位，包含字母和数字
- 告知用户后建议其自行修改

### 3. 定期检查

```bash
# 每月检查一次用户情况
python list_users.py
```

---

## 🚀 快速命令参考

```bash
# 进入后端目录
cd tg_choujiang/backend

# 创建用户（交互式）
python create_user.py

# 创建用户（快速）
python create_user.py 用户名 密码 姓名

# 查看所有用户
python list_users.py

# 修改密码（交互式）
python change_password.py

# 修改密码（快速）
python change_password.py 用户名 新密码
```

---

## ❓ 常见问题

### Q1: 可以删除用户吗？

可以，但需要在 Django admin 或使用 shell：

```bash
python manage.py shell

# 在 shell 中
from django.contrib.auth.models import User
User.objects.get(username='要删除的用户名').delete()
```

⚠️ 删除用户会同时删除其所有抽奖数据！

### Q2: 可以转移抽奖归属吗？

可以，使用 shell：

```bash
python manage.py shell

# 在 shell 中
from lottery.models import Lottery
from django.contrib.auth.models import User

# 获取用户
old_user = User.objects.get(username='boss1')
new_user = User.objects.get(username='boss2')

# 转移所有抽奖
Lottery.objects.filter(admin_user=old_user).update(admin_user=new_user)
```

### Q3: 系统最多支持多少个用户？

理论上无限制，实际取决于服务器性能。建议不超过 100 个并发用户。

---

## 📞 技术支持

如有问题，请查看：
- 多租户实施指南：`tg_choujiang/多租户实施指南.md`
- 快速开始：`tg_choujiang/QUICK_START.md`
